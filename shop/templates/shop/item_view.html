{% extends 'main2.html' %}
{% load static %}

{% block title %}Shop{% endblock title %}

{% block content %}

<section class="py-5">
    <div class="container px-4 px-lg-5 my-5">
        <a href="../"><i class='far fa-arrow-alt-circle-left mb-4' style='color:black; font-size:xx-large;'></i></a>
        <div class="row gx-4 gx-lg-5 align-items-center">
            <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0" src="{{ item.product_image.url }}" alt="..." />
            </div>
            <div class="col-md-6">
                <div class="small mb-1">{{ item.category }}</div>
                <h1 class="display-5 fw-bolder">{{ item.product_name }}</h1>
                <div class="fs-5 mb-5">
                    <span><b>Price: </b></span><span>â‚±{{ item.price }}</span>
                </div>

                <p class="lead">{{ item.description|linebreaksbr}}</p>
                <hr>
                <div class="fs-5 mb-3">
                    <span><b>Remaining Stocks: </b></span> <span> </span>{{ item.tempo_quantity }}
                </div>


                <div class="form-inline">
                    <label><b>Quantity: </b></label> 
                    <input class="form-control text-center me-1 ml-3"
                        id="inputQuantity" type="num" value="{{ item.min_orders }}" style="max-width: 3rem" />
                </div>
                <br>
                <button class="btn btn-outline-dark flex-shrink-0" id="add-button" value="{{item.id}}" type="button">
                    <i class="bi-cart-fill me-1"></i>
                    Add to cart
                </button>
            </div>
        </div>
    </div>
</section>

<script>
    const addButton = document.querySelector('#add-button');
    const inputQuantity = document.querySelector('#inputQuantity');
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');


    addButton.addEventListener('click', async function (e) {
        e.preventDefault();
        const response = await fetch("http://127.0.0.1:8000/cart/add/", {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({
                productid: addButton.value,
                productqty: inputQuantity.value,
                csrfmiddlewaretoken: "{{csrf_token}}",
                action: 'post'
            })
        })

        const data = await response.json();
        if (data) {
            document.querySelector('#basket-qty').innerHTML = data.qty;
        }


    });
</script>
{% endblock content %}