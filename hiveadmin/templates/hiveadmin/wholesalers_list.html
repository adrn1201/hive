{% extends 'admin.html' %}
{% block title %}Admin{% endblock title %}
{% block content %}




<div class="panel-header panel-header-sm">
</div>
<button type="button" class="btn btn-warning text-dark" data-mdb-toggle="modal" data-mdb-target="#staticBackdrop1">
  Add Wholesaler
</button>
<!-- Modal -->
<div class="modal fade" id="staticBackdrop1" tabindex="-1" aria-labelledby="exampleModalLabel1" aria-hidden="true">
  <div class="modal-dialog d-flex justify-content-center">
    <div class="modal-content w-75">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel1">Add a Wholesaler</h5>
        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form action="" method="POST" class="form">
          {% csrf_token %}
          <div class="form-outline mb-4">
            <input type="email" name="email" id="email" class="form-control" />
            <label class="form-label" for="email">Wholesaler's Email address</label>
          </div>
          <!-- Submit button -->
          <button type="submit" class="btn btn-primary btn-block">Send Email</button>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->

<!-- Modal2 -->
<!--Modal: modalConfirmDelete-->
<div class="modal fade" id="staticBackdrop2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-sm modal-notify modal-danger" role="document">
    <!--Content-->
    <div class="modal-content text-center">
      <!--Header-->
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Update Status</p>
      </div>

      <!--Body-->
      <div class="modal-body">

        <i class="fas fa-info-circle fa-3x"></i>
        <br><br>
        This wholesaler's account status will be updated

      </div>

      <!--Footer-->
      <div class="modal-footer flex-center">
        <form action="#">
          {% csrf_token %}

          <button type="submit" class="btn btn-outline-secondary">Yes</button>
          <a type="button" class="btn  btn-outline-secondary" data-mdb-dismiss="modal">No</a>

        </form>
      </div>
    </div>
    <!--/.Content-->
  </div>
</div>
<div class="content">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Wholesalers</h4>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table">
              <thead class=" text-primary">
                <th>
                  Business Name
                </th>
                <th>
                  Status
                </th>
                <th>
                  Date Joined
                </th>
                <th>
                  Action
                </th>
              </thead>
              <tbody>
                {% for wholesaler in wholesalers %}
                <tr>
                  <td>
                    {{ wholesaler.business_name }}
                  </td>
                  <td>
                    {{ wholesaler.is_active|yesno:"Active,Inactive" }}
                  </td>
                  <td>
                    {{ wholesaler.created}}
                  </td>
                  <td>
                    <form method="POST" action="{% url 'update_wholesaler' wholesaler.id %}" class="updateForm"
                      data-product="{{wholesaler.business_name}}">
                      {% csrf_token %}
                      <button type="submit" class="btn  btn-info  btn-xs "><i class="far fa-edit"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
{% if messages %}
{% for message in messages %}
<script>
  swal("{{message}}", "", "success");
</script>


{% comment %} <div style="display: flex; justify-content: center;">
  <div class="alert alert--{{message.tags}}">
    <p class="alert__message">{{message}}</p>
    <button class="alert__close">x</button>
  </div>
</div> {% endcomment %}
{% endfor %}
{% endif %}

<script>
  const updateForms = document.querySelectorAll('.updateForm');

  for (const item of updateForms) {
    item.addEventListener('click', (e) => {
      e.preventDefault()
      let name = item.dataset.product
      swal({
          title: `Update the account status of ${name}?`,
          icon: "warning",
          buttons: true,
          dangerMode: true,
        })
        .then((willDelete) => {
          if (willDelete) {
            item.submit()
          }

        });
    })

  }

  $(document).ready(function () {
    $('.form').on('submit', function () {
      swal("Success!", "Registration Link has been sent!", "success", {
        button: "Ok",
      });
    });
  });
</script>

{% endblock content %}